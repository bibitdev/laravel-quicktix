@extends('layouts.app')

@section('title', 'Dashboard Analytics')

@push('style')
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="{{ asset('library/chart.js/dist/Chart.min.css') }}">
    <style>
        .card-statistic-1 {
            transition: transform 0.3s ease;
        }
        .card-statistic-1:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .card-header-action select {
            height: 35px;
            padding: 0 15px;
            border-radius: 4px;
            border: 1px solid #e4e6fc;
            font-size: 13px;
            color: #34395e;
        }
        .comparison-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }
        .badge-up {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .badge-down {
            background: #ffebee;
            color: #c62828;
        }
        .insight-card {
            border-left: 4px solid;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-success {
            border-left-color: #28a745;
            background: #f0f9f4;
        }
        .insight-warning {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        .insight-info {
            border-left-color: #17a2b8;
            background: #f0f8ff;
        }
        .prediction-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-confidence-high {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .badge-confidence-medium {
            background: #fff3e0;
            color: #e65100;
        }
        .table-prediction {
            font-size: 13px;
        }
        .table-prediction th {
            background: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
    </style>
@endpush

@section('main')
    <div class="main-content">
        <section class="section">
            <div class="section-header">
                <h1>Dashboard Analitik</h1>
            </div>

            <div class="section-body">
                <!-- Key Metrics with Comparison -->
                <div class="row">
                    <!-- Total Visitors (6 months) -->
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="card card-statistic-1">
                            <div class="card-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="card-wrap">
                                <div class="card-header">
                                    <h4>Total Pengunjung (6Jan)</h4>
                                </div>
                                <div class="card-body">
                                    {{ number_format($total_visitors) }}
                                </div>
                                @if(isset($visitor_comparison))
                                <span class="comparison-badge badge-{{ $visitor_comparison['trend'] }}">
                                    <i class="fas fa-arrow-{{ $visitor_comparison['trend'] == 'up' ? 'up' : 'down' }}"></i>
                                    {{ abs($visitor_comparison['percentage']) }}% vs {{ now()->subMonth()->format('M') }}
                                </span>
                                @endif
                            </div>
                        </div>
                    </div>

                    <!-- Total Revenue -->
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="card card-statistic-1">
                            <div class="card-icon bg-success">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="card-wrap">
                                <div class="card-header">
                                    <h4>Pendapatan (6Jan)</h4>
                                </div>
                                <div class="card-body">
                                    Rp {{ number_format($total_revenue / 1000000, 1) }} Jt
                                </div>
                                @if(isset($revenue_comparison))
                                <span class="comparison-badge badge-{{ $revenue_comparison['trend'] }}">
                                    <i class="fas fa-arrow-{{ $revenue_comparison['trend'] == 'up' ? 'up' : 'down' }}"></i>
                                    {{ abs($revenue_comparison['percentage']) }}% vs kemarin
                                </span>
                                @endif
                            </div>
                        </div>
                    </div>

                    <!-- Average Daily Visitors -->
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="card card-statistic-1">
                            <div class="card-icon bg-warning">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="card-wrap">
                                <div class="card-header">
                                    <h4>Rata-rata/Hari</h4>
                                </div>
                                <div class="card-body">
                                    {{ $avg_daily_visitors }}
                                </div>
                                <small class="text-muted">pengunjung</small>
                            </div>
                        </div>
                    </div>

                    <!-- Peak Ratio -->
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="card card-statistic-1">
                            <div class="card-icon bg-info">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-wrap">
                                <div class="card-header">
                                    <h4>Peak Day Ratio</h4>
                                </div>
                                <div class="card-body">
                                    {{ $peak_ratio }}x
                                </div>
                                <small class="text-muted">weekend vs weekday</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights & Recommendations -->
                @if(isset($insights) && count($insights) > 0)
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-lightbulb text-warning"></i> Insights & Rekomendasi</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    @foreach($insights as $insight)
                                    <div class="col-lg-6 col-md-12">
                                        <div class="insight-card insight-{{ $insight['type'] }} p-3 rounded">
                                            <div class="d-flex align-items-start">
                                                <span style="font-size: 24px; margin-right: 12px;">{{ $insight['icon'] }}</span>
                                                <div>
                                                    <h6 class="mb-1 font-weight-bold">{{ $insight['title'] }}</h6>
                                                    <p class="mb-0 text-muted" style="font-size: 13px;">{{ $insight['message'] }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @endif

                <!-- Trend Analysis (6 Months) -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Tren Pengunjung 6 Bulan Terakhir</h4>
                                <div class="card-header-action">
                                    <span class="badge badge-info">Analisis time series untuk identifikasi pola musiman</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="trendChart" height="100"></canvas>
                                @if(isset($trend_insight))
                                <div class="alert alert-info mt-3 mb-0">
                                    <strong><i class="fas fa-chart-line"></i> Insight:</strong> 
                                    Puncak pengunjung terjadi di <strong>{{ $trend_insight['peak_month'] ?? '-' }}</strong>. 
                                    @if($trend_insight['last_month_change'] > 0)
                                        Bulan ini naik <strong>{{ $trend_insight['last_month_change'] }}%</strong> dibanding bulan lalu.
                                    @elseif($trend_insight['last_month_change'] < 0)
                                        Bulan ini turun <strong>{{ abs($trend_insight['last_month_change']) }}%</strong> dibanding bulan lalu.
                                    @else
                                        Weekend konsisten <strong>1x lebih ramai</strong> dari weekday.
                                    @endif
                                </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Holiday Impact Analysis -->
                @if(isset($holiday_impact) && count($holiday_impact) > 0)
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Dampak Hari Libur Nasional</h4>
                                <div class="card-header-action">
                                    <span class="badge badge-primary">Perbandingan pengunjung saat libur vs hari normal</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="holidayImpactChart" height="80"></canvas>
                                <div class="row mt-4">
                                    @foreach($holiday_impact as $holiday)
                                    <div class="col-lg-3 col-md-6 text-center">
                                        <h6 class="font-weight-bold">{{ $holiday['name'] }}</h6>
                                        <h3 class="text-{{ $holiday['impact'] >= 100 ? 'success' : ($holiday['impact'] >= 50 ? 'warning' : 'info') }}">
                                            {{ $holiday['impact'] >= 0 ? '+' : '' }}{{ $holiday['impact'] }}%
                                        </h3>
                                        <small class="text-muted">vs normal</small>
                                    </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @endif

                <!-- Forecast (7 Days Ahead) -->
                @if(isset($forecast_data) && count($forecast_data) > 0)
                <div class="row">
                    <div class="col-lg-7">
                        <div class="card">
                            <div class="card-header">
                                <h4>Prediksi Minggu Depan ({{ now()->addDay()->format('d') }}-{{ now()->addDays(7)->format('d M Y') }})</h4>
                                <div class="card-header-action">
                                    <span class="prediction-badge badge-confidence-high">Dengan confidence interval 95%</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="forecastChart" height="90"></canvas>
                                <div class="alert alert-warning mt-3 mb-0">
                                    <strong><i class="fas fa-info-circle"></i> Interpretasi:</strong> 
                                    Area abu-gray menunjukkan range kemungkinan (CI 95%). Weekend diprediksi 14-14 pengunjung.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="card">
                            <div class="card-header">
                                <h4>Detail Prediksi & Rekomendasi Operasional</h4>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-striped table-prediction mb-0">
                                        <thead>
                                            <tr>
                                                <th>Hari</th>
                                                <th>Prediksi</th>
                                                <th>Range (95% CI)</th>
                                                <th>Kasir</th>
                                                <th>Est. Pendapatan</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach($forecast_details as $detail)
                                            <tr class="{{ $detail['is_weekend'] ? 'bg-light font-weight-bold' : '' }}">
                                                <td>
                                                    {{ $detail['day'] }}
                                                    @if($detail['is_weekend'])
                                                        <span class="badge badge-primary badge-sm">Weekend</span>
                                                    @endif
                                                    @if($detail['is_holiday'])
                                                        <span class="badge badge-danger badge-sm">Libur</span>
                                                    @endif
                                                </td>
                                                <td>
                                                    <span class="badge badge-{{ $detail['prediction'] > 40 ? 'success' : 'info' }}">
                                                        {{ $detail['prediction'] }} orang
                                                    </span>
                                                </td>
                                                <td><small>{{ $detail['range'] }}</small></td>
                                                <td>{{ $detail['kasir'] }}</td>
                                                <td>Rp {{ number_format($detail['revenue'] / 1000) }}K</td>
                                            </tr>
                                            @endforeach
                                            <tr class="bg-info text-white">
                                                <td colspan="2"><strong>Total Minggu</strong></td>
                                                <td colspan="3">
                                                    <strong>{{ array_sum(array_column($forecast_details, 'prediction')) }} orang</strong> | 
                                                    <strong>Rp {{ number_format(array_sum(array_column($forecast_details, 'revenue')) / 1000000, 1) }} Jt</strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="p-3 bg-light">
                                    <small class="text-muted">* Kebutuhan kasir: 1 kasir per 25 pengunjung per shift</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @endif

                </div>

                <!-- Charts (Daily) -->
                <div class="row">
                    <!-- Visitor Trends (Tiket Terjual) -->
                    <div class="col-lg-6 col-md-12 col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Tren Penjualan Tiket (7 Hari Terakhir)</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="visitorTrend" height="180"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Sales Revenue -->
                    <div class="col-lg-6 col-md-12 col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Tren Pendapatan (7 Hari Terakhir)</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="salesTrend" height="180"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Payment Methods -->
                    <div class="col-lg-12 col-md-12 col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>Transaksi per Metode Pembayaran</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="paymentMethods" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
@endsection

@push('scripts')
    <!-- JS Libraries -->
    <script src="{{ asset('library/chart.js/dist/Chart.min.js') }}"></script>

    <!-- Dashboard Analytics Charts -->
    <script>
        // Prepare data from PHP
        const ticketSalesTrend = @json($ticket_sales_trend ?? []);
        const revenueTrend = @json($revenue_trend ?? []);
        const paymentMethods = @json($payment_methods ?? []);
        const trendData = @json($trend_data ?? []);
        const holidayImpact = @json($holiday_impact ?? []);
        const forecastData = @json($forecast_data ?? []);

        console.log('Chart.js loaded:', typeof Chart !== 'undefined');

        // Extract dates and totals for charts
        const visitorData = {
            dates: ticketSalesTrend.map(item => item.date),
            counts: ticketSalesTrend.map(item => item.total)
        };

        const salesData = {
            dates: revenueTrend.map(item => item.date),
            totals: revenueTrend.map(item => item.total)
        };

        const paymentData = {
            methods: paymentMethods.map(item => item.payment_method),
            counts: paymentMethods.map(item => item.count),
            totals: paymentMethods.map(item => item.total)
        };

        // 1. Visitor Trend Chart (7 Days)
        const visitorCanvas = document.getElementById('visitorTrend');
        if (visitorCanvas) {
            new Chart(visitorCanvas, {
                type: 'line',
                data: {
                    labels: visitorData.dates.length > 0 ? visitorData.dates : ['Belum ada data'],
                    datasets: [{
                        label: 'Jumlah Tiket Terjual',
                        data: visitorData.counts.length > 0 ? visitorData.counts : [0],
                        borderColor: '#6777ef',
                        backgroundColor: 'rgba(103, 119, 239, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#6777ef',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Tiket: ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 5 } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // 2. Sales Trend Chart (7 Days)
        const salesCanvas = document.getElementById('salesTrend');
        if (salesCanvas) {
            new Chart(salesCanvas, {
                type: 'line',
                data: {
                    labels: salesData.dates.length > 0 ? salesData.dates : ['Belum ada data'],
                    datasets: [{
                        label: 'Total Pendapatan',
                        data: salesData.totals.length > 0 ? salesData.totals : [0],
                        borderColor: '#48c78e',
                        backgroundColor: 'rgba(72, 199, 142, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#48c78e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                                    if (value >= 1000) return (value / 1000).toFixed(0) + 'k';
                                    return value;
                                }
                            }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // 3. Payment Methods Chart
        const paymentCanvas = document.getElementById('paymentMethods');
        if (paymentCanvas) {
            new Chart(paymentCanvas, {
                type: 'bar',
                data: {
                    labels: paymentData.methods.length > 0 ? paymentData.methods : ['Belum ada data'],
                    datasets: [{
                        label: 'Jumlah Transaksi',
                        data: paymentData.counts.length > 0 ? paymentData.counts : [0],
                        backgroundColor: ['rgba(103, 119, 239, 0.8)', 'rgba(72, 199, 142, 0.8)', 'rgba(255, 159, 64, 0.8)'],
                        borderColor: ['rgba(103, 119, 239, 1)', 'rgba(72, 199, 142, 1)', 'rgba(255, 159, 64, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' transaksi';
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 10 } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // 4. Trend Chart (6 Months)
        const trendCanvas = document.getElementById('trendChart');
        if (trendCanvas && trendData.length > 0) {
            new Chart(trendCanvas, {
                type: 'line',
                data: {
                    labels: trendData.map(item => item.month),
                    datasets: [
                        {
                            label: 'Total Pengunjung',
                            data: trendData.map(item => item.total),
                            borderColor: '#34395e',
                            backgroundColor: 'rgba(52, 57, 94, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: '#34395e'
                        },
                        {
                            label: 'Weekend',
                            data: trendData.map(item => item.weekend),
                            borderColor: '#6777ef',
                            backgroundColor: 'rgba(103, 119, 239, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4
                        },
                        {
                            label: 'Weekday',
                            data: trendData.map(item => item.weekday),
                            borderColor: '#48c78e',
                            backgroundColor: 'rgba(72, 199, 142, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // 5. Holiday Impact Chart
        const holidayCanvas = document.getElementById('holidayImpactChart');
        if (holidayCanvas && holidayImpact.length > 0) {
            new Chart(holidayCanvas, {
                type: 'bar',
                data: {
                    labels: holidayImpact.map(h => h.name),
                    datasets: [
                        {
                            label: 'Rata-rata Normal',
                            data: holidayImpact.map(h => h.normal),
                            backgroundColor: 'rgba(200, 200, 200, 0.5)',
                            borderColor: 'rgba(150, 150, 150, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Saat Libur',
                            data: holidayImpact.map(h => h.holiday),
                            backgroundColor: 'rgba(72, 133, 237, 0.8)',
                            borderColor: 'rgba(72, 133, 237, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // 6. Forecast Chart with Confidence Interval
        const forecastCanvas = document.getElementById('forecastChart');
        if (forecastCanvas && forecastData.length > 0) {
            new Chart(forecastCanvas, {
                type: 'line',
                data: {
                    labels: forecastData.map(f => f.day),
                    datasets: [
                        {
                            label: 'Upper Bound (97.5%)',
                            data: forecastData.map(f => f.upper),
                            borderColor: 'rgba(200, 200, 200, 0.3)',
                            backgroundColor: 'rgba(200, 200, 200, 0.1)',
                            borderWidth: 1,
                            fill: '+1',
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Prediksi',
                            data: forecastData.map(f => f.prediction),
                            borderColor: '#4885ed',
                            backgroundColor: 'rgba(72, 133, 237, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: forecastData.map(f => f.is_weekend || f.is_holiday ? '#4885ed' : '#48c78e'),
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Lower Bound (2.5%)',
                            data: forecastData.map(f => f.lower),
                            borderColor: 'rgba(200, 200, 200, 0.3)',
                            backgroundColor: 'rgba(200, 200, 200, 0.1)',
                            borderWidth: 1,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 1) {
                                        return 'Prediksi: ' + context.parsed.y + ' pengunjung';
                                    }
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Jumlah Pengunjung' }
                        },
                        x: { 
                            grid: { display: false },
                            title: { display: true, text: 'Hari' }
                        }
                    }
                }
            });
        }

        console.log('All charts initialized!');
    </script>
@endpush

                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });
        }

        // Sales Trend Chart (Pendapatan)
        const salesCanvas = document.getElementById('salesTrend');
        if (!salesCanvas) {
            console.error('Canvas element salesTrend not found!');
        } else {
            console.log('Creating salesTrend chart...');
            const salesTrend = new Chart(salesCanvas, {
            type: 'line',
            data: {
                labels: salesData.dates.length > 0 ? salesData.dates : ['Belum ada data'],
                datasets: [{
                    label: 'Total Pendapatan',
                    data: salesData.totals.length > 0 ? salesData.totals : [0],
                    borderColor: '#48c78e',
                    backgroundColor: 'rgba(72, 199, 142, 0.15)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.5,
                    pointRadius: 4,
                    pointBackgroundColor: '#48c78e',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        align: 'start',
                        labels: {
                            usePointStyle: true,
                            boxWidth: 8,
                            padding: 15
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return 'Rp ' + context.parsed.y.toLocaleString('id-ID');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000000) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                } else if (value >= 1000) {
                                    return (value / 1000).toFixed(0) + 'k';
                                }
                                return value;
                            },
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });
        }

        // Payment Methods Chart (Horizontal Bar Chart)
        const paymentCanvas = document.getElementById('paymentMethods');
        if (!paymentCanvas) {
            console.error('Canvas element paymentMethods not found!');
        } else {
            console.log('Creating paymentMethods chart...');
            const paymentMethodsChart = new Chart(paymentCanvas, {
            type: 'bar',
            data: {
                labels: paymentData.methods.length > 0 ? paymentData.methods : ['Belum ada data'],
                datasets: [{
                    label: 'Jumlah Transaksi',
                    data: paymentData.counts.length > 0 ? paymentData.counts : [0],
                    backgroundColor: [
                        'rgba(103, 119, 239, 0.8)',
                        'rgba(72, 199, 142, 0.8)',
                        'rgba(255, 159, 64, 0.8)'
                    ],
                    borderColor: [
                        'rgba(103, 119, 239, 1)',
                        'rgba(72, 199, 142, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        align: 'start',
                        labels: {
                            usePointStyle: true,
                            boxWidth: 8,
                            padding: 15
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + ' transaksi';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });
        }

        console.log('All charts initialized!');
    </script>
@endpush
